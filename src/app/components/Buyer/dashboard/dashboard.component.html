 <app-navbar></app-navbar>

<div class="cart-container">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="filter-header">
      <div class="filter-title">
        <svg class="filter-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M3 4h18M3 12h12M3 20h6" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span>Smart Filter</span>
      </div>
      <button class="clear-all" (click)="clearAllFilters()">Clear all</button>
    </div>

    <!-- Filter Items -->
    
    <!-- Project Type Filter -->
    <div class="filter-item">
      <div class="filter-item-header" (click)="toggleFilter('projectType')">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
        </svg>
        <span>Project type</span>
        <svg class="chevron" [class.expanded]="filterExpanded.projectType" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="filter-content" *ngIf="filterExpanded.projectType">
        <label class="filter-option" *ngFor="let type of projectTypes">
          <input type="checkbox" 
                 [checked]="selectedProjectTypes.includes(type.value)"
                 (change)="toggleProjectType(type.value)">
          <span class="color-dot" [style.background-color]="type.color"></span>
          <span>{{ type.label }}</span>
        </label>
      </div>
    </div>

    <!-- Country Filter -->
    <div class="filter-item">
      <div class="filter-item-header" (click)="toggleFilter('country')">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="10"/>
          <path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" stroke="white" stroke-width="1"/>
        </svg>
        <span>Country</span>
        <svg class="chevron" [class.expanded]="filterExpanded.country" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="filter-content" *ngIf="filterExpanded.country">
        <div class="search-box-filter">
          <svg class="search-icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="11" cy="11" r="8" stroke-width="2"/>
            <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <input 
            type="text" 
            placeholder="Search Country" 
            [(ngModel)]="countrySearchQuery"
            class="search-input-filter"
          />
          <button class="clear-search" *ngIf="countrySearchQuery" (click)="countrySearchQuery = ''">×</button>
        </div>
        <label class="filter-option country-option" *ngFor="let country of filteredCountries">
          <input type="checkbox" 
                 [checked]="selectedCountries.includes(country.value)"
                 (change)="toggleCountry(country.value)">
          <span>{{ country.flag }} {{ country.label }}</span>
          <span class="country-code">{{ country.code }}</span>
        </label>
      </div>
    </div>

    <!-- Vintage Year Filter -->
    <div class="filter-item">
      <div class="filter-item-header" (click)="toggleFilter('vintageYear')">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6" stroke="white" stroke-width="1.5"/>
          <line x1="8" y1="2" x2="8" y2="6" stroke="white" stroke-width="1.5"/>
          <line x1="3" y1="10" x2="21" y2="10" stroke="white" stroke-width="1.5"/>
        </svg>
        <span>Vintage Year</span>
        <svg class="chevron" [class.expanded]="filterExpanded.vintageYear" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="filter-content" *ngIf="filterExpanded.vintageYear">
        <div class="year-range-display">
          <span class="year-label">{{ vintageYearRange[0] }} - {{ vintageYearRange[1] }}</span>
          <span class="year-count">{{ vintageYearRange[1] - vintageYearRange[0] + 1 }} Years</span>
        </div>
        <div class="range-slider">
          <input type="range" 
                 [min]="2000" 
                 [max]="2025" 
                 [(ngModel)]="vintageYearRange[0]"
                 (input)="onVintageYearChange()"
                 class="slider slider-min">
          <input type="range" 
                 [min]="2000" 
                 [max]="2025" 
                 [(ngModel)]="vintageYearRange[1]"
                 (input)="onVintageYearChange()"
                 class="slider slider-max">
        </div>
        <div class="year-labels">
          <span>2000</span>
          <span>2025</span>
        </div>
      </div>
    </div>

    <!-- Price Range Filter -->
    <div class="filter-item" (click)="toggleFilter('priceRange')">
      <div class="filter-item-header">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
        <span>Price Range</span>
        <svg class="chevron" [class.expanded]="filterExpanded.priceRange" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- Registry Filter -->
    <div class="filter-item" (click)="toggleFilter('registry')">
      <div class="filter-item-header">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
        </svg>
        <span>Registry</span>
        <svg class="chevron" [class.expanded]="filterExpanded.registry" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- UN SDGs Filter -->
    <div class="filter-item" (click)="toggleFilter('unSdgs')">
      <div class="filter-item-header">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="10"/>
          <path d="M12 6v6l4 2" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span>UN SDGs</span>
        <svg class="chevron" [class.expanded]="filterExpanded.unSdgs" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- Stocks Filter -->
    <div class="filter-item" (click)="toggleFilter('stocks')">
      <div class="filter-item-header">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 20V10M12 20V4M6 20v-6"/>
        </svg>
        <span>Stocks</span>
        <svg class="chevron" [class.expanded]="filterExpanded.stocks" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- Impacts Filter -->
    <div class="filter-item" (click)="toggleFilter('impacts')">
      <div class="filter-item-header">
        <svg class="filter-item-icon" viewBox="0 0 24 24" fill="currentColor">
          <circle cx="12" cy="12" r="10"/>
          <path d="M8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
        <span>Impacts</span>
        <svg class="chevron" [class.expanded]="filterExpanded.impacts" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M9 18l6-6-6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <!-- Filter Actions -->
    <div class="filter-actions">
      <button class="clear-filter-btn" (click)="clearAllFilters()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 3v5h5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Clear Filter
      </button>
      <button class="applied-filter-btn" (click)="applyFilters()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <polyline points="22 4 12 14.01 9 11.01" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Applied Filter
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="search-box">
        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <circle cx="11" cy="11" r="8" stroke-width="2"/>
          <path d="m21 21-4.35-4.35" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input 
          type="text" 
          placeholder="Search Projects....." 
          [(ngModel)]="searchQuery"
          class="search-input"
        />
      </div>

      <div class="top-controls">
        
        <div class="dropdown">
          <select [(ngModel)]="selectedStatus" class="select-input">
            <option value="all">Status: All</option>
            <option value="in-stock">In Stock</option>
            <option value="out-of-stock">Out of Stock</option>
          </select>
        </div>

        <div class="dropdown">
          <select [(ngModel)]="selectedSort" class="select-input">
            <option value="newest">Sort: Newest</option>
            <option value="oldest">Sort: Oldest</option>
          </select>
        </div>

        <div class="dropdown">
          <select [(ngModel)]="selectedPrice" class="select-input">
            <option value="low-high">Price: Low to high</option>
            <option value="high-low">Price: High to low</option>
          </select>
        </div>

        <div class="dropdown">
          <select [(ngModel)]="currency" class="select-input">
            <option value="US ($)">US ($)</option>
            <option value="EUR (€)">EUR (€)</option>
            <option value="GBP (£)">GBP (£)</option>
          </select>
        </div>

        <div class="view-controls">
          <button 
            class="view-btn" 
            [class.active]="viewMode === 'grid'"
            (click)="setViewMode('grid')"
          >
            <svg viewBox="0 0 24 24" fill="currentColor">
              <rect x="3" y="3" width="7" height="7" rx="1"/>
              <rect x="14" y="3" width="7" height="7" rx="1"/>
              <rect x="3" y="14" width="7" height="7" rx="1"/>
              <rect x="14" y="14" width="7" height="7" rx="1"/>
            </svg>
          </button>
          <button 
            class="view-btn" 
            [class.active]="viewMode === 'list'"
            (click)="setViewMode('list')"
          >
            <svg viewBox="0 0 24 24" fill="currentColor">
              <line x1="8" y1="6" x2="21" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="8" y1="12" x2="21" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="8" y1="18" x2="21" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="3" y1="6" x2="3.01" y2="6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="3" y1="12" x2="3.01" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="3" y1="18" x2="3.01" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button 
            class="view-btn" 
            [class.active]="viewMode === 'compact'"
            (click)="setViewMode('compact')"
          >
            <svg viewBox="0 0 24 24" fill="currentColor">
              <rect x="3" y="3" width="7" height="7" rx="1"/>
              <rect x="14" y="3" width="7" height="7" rx="1"/>
              <rect x="3" y="14" width="7" height="7" rx="1"/>
              <rect x="14" y="14" width="7" height="7" rx="1"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- Projects Grid -->
    <div class="projects-grid">
      <div class="card" *ngFor="let project of filteredProjects"  (click)="openProjectDetails(project)">
        <div class="card-image-container">
          <img [src]="project.image" [alt]="project.name" class="card-image">
          <div class="stock-badge" *ngIf="project.inStock">In Stock</div>
          <button class="favorite-btn" (click)="toggleFavorite(project, $event)" [class.active]="isFavorite">
            <img src="assets/images/heart.svg" class="favorite-icon" [style.filter]="isFavorite ? 'drop-shadow(0 0 4px #ff4757)' : ''">
          </button>
        </div>

        <div class="card-content">
          <div class="sdg-badge-container">
            <div class="sdg-circle" [style.background]="getGradientString(project)">
              <div class="sdg-inner">
                <div class="sdg-number">{{ project.sdgs }}</div>
                <div class="sdg-label">SDGs</div>
              </div>
            </div>
            <div class="tag">
              <div class="category-badge">{{ project.tag }}</div>
            </div>
          </div>

          <h2 class="card-title">{{ project.name }}</h2>
          <p class="card-description">{{ project.description }}</p>

          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Vintage :</span>
              <span class="info-value">{{ project.vintage }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Country :</span>
              <span class="info-value">{{ project.countryFlag }} {{ project.country }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Registry :</span>
              <span class="info-value highlight">{{ project.registry }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Industry :</span>
              <span class="info-value">{{ project.industry }}</span>
            </div>
          </div>

          <div class="price-section">
            <div class="price">
              <span class="price-amount">${{ project.price }}</span>
              <span class="price-unit">/ton</span>
            </div>
            <div class="availability">
              <span class="availability-value"><span class="availability-label">Available: </span>{{ project.available.toLocaleString() }} UD</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>