<div class="token-details-container">
  <div class="main-content">
    <!-- Header Section -->
    <div class="header-section">
      <div>
        <h1 class="page-title">Token Batch Details – [TKN-VER-2025-0012]</h1>
        <p class="page-description">
          This page provides a detailed view of your tokenized carbon credit batch. Each token represents one verified 
          carbon credit backed by the registry and linked to your project.
        </p>
      </div>
    </div>

    <!-- Lifecycle Tracker -->
    <div class="info-box lifecycle-tracker">
      <p>You can track the token lifecycle – from minting to transfer, sale, or retirement – and download verifiable proof anytime.</p>
    </div>

    <!-- Batch Overview -->
    <section class="card">
      <h2 class="section-title">Batch Overview</h2>
      
      <div class="details-grid">
        <div class="detail-item">
          <label>Batch ID</label>
          <p class="detail-value">{{ batchDetails.batchId }}</p>
        </div>
        
        <div class="detail-item">
          <label>Project Name</label>
          <p class="detail-value">{{ batchDetails.projectName }}</p>
        </div>

        <div class="detail-item">
          <label>Registry Reference ID</label>
          <p class="detail-value">{{ batchDetails.registryReferenceId }}</p>
        </div>

        <div class="detail-item">
          <label>Registry Name</label>
          <p class="detail-value">{{ batchDetails.registryName }}</p>
        </div>

        <div class="detail-item">
          <label>Verification Standard</label>
          <p class="detail-value">{{ batchDetails.verificationStandard }}</p>
        </div>

        <div class="detail-item">
          <label>Blockchain Network</label>
          <p class="detail-value">{{ batchDetails.blockchainNetwork }}</p>
        </div>

        <div class="detail-item">
          <label>Total Tokens Minted</label>
          <p class="detail-value">{{ batchDetails.totalTokensMinted | number }}</p>
        </div>

        <div class="detail-item">
          <label>Current Token Status</label>
          <p class="detail-value">{{ batchDetails.currentTokenStatus }}</p>
        </div>

        <div class="detail-item">
          <label>Mint Date</label>
          <p class="detail-value">{{ batchDetails.mintDate }}</p>
        </div>
      </div>

      <div class="info-note">
        All tokens in this batch are directly linked to underlying credits issued by the registry.
      </div>
    </section>

    <!-- Token Lifecycle Progress -->
    <section class="card">
      <h2 class="section-title">Token Lifecycle Progress</h2>
      
      <div class="lifecycle-steps">
        <div *ngFor="let step of lifecycleSteps" class="lifecycle-step">
          <div class="step-indicator">
            <div class="step-icon" [class.active]="step.status === 'Completed' || step.status === 'In Progress'">
              <svg *ngIf="step.status === 'Completed'" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M13.3333 4L6 11.3333L2.66666 8" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span *ngIf="step.status !== 'Completed'">{{ step.step }}</span>
            </div>
            <div *ngIf="step.step < lifecycleSteps.length" class="step-connector"></div>
          </div>
          
          <div class="step-content">
            <div class="step-header">
              <h3 class="step-title">{{ step.step }}. {{ step.title }}</h3>
              <span class="step-status" [ngClass]="getStatusClass(step.status)">{{ step.status }}</span>
            </div>
            <p class="step-description">{{ step.description }}</p>
            <p class="step-date">{{ step.date }}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Token Distribution and Blockchain Records -->
    <div class="two-column-layout">
      <!-- Token Distribution Summary -->
      <section class="card">
        <h2 class="section-title">Token Distribution Summary</h2>
        
        <div class="chart-container">
          <highcharts-chart
            [Highcharts]="Highcharts"
            [options]="chartOptions"
            style="width: 100%; display: block;">
          </highcharts-chart>
        </div>

        <div class="distribution-stats">
          <div class="stat-item">
            <span class="stat-label">Retired</span>
            <span class="stat-value retired">{{ tokenDistribution.retired }} <span class="stat-percentage">4.00%</span></span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Sold</span>
            <span class="stat-value sold">{{ tokenDistribution.sold }} <span class="stat-percentage">16.00%</span></span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Available</span>
            <span class="stat-value available">{{ tokenDistribution.available }} <span class="stat-percentage">80.00%</span></span>
          </div>
        </div>
      </section>

      <!-- Blockchain Records -->
      <section class="card">
        <h2 class="section-title">Blockchain Records</h2>
        
        <div class="blockchain-details">
          <div class="blockchain-item">
            <label>Transfer Transaction ID</label>
            <p class="blockchain-value">{{ blockchainRecords.transferTransactionId }}</p>
          </div>

          <div class="blockchain-item">
            <label>Smart Contract Address</label>
            <p class="blockchain-value">{{ blockchainRecords.smartContractAddress }}</p>
          </div>

          <div class="blockchain-item">
            <label>Custody Type</label>
            <p class="blockchain-value">{{ blockchainRecords.custodyType }}</p>
          </div>

          <div class="blockchain-item">
            <label>Bridge Reference ID</label>
            <p class="blockchain-value">{{ blockchainRecords.bridgeReferenceId }}</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Sales and Retirement Log -->
    <section class="card">
      <div class="section-header">
        <h2 class="section-title">Sales and Retirement Log</h2>
        <button class="download-btn" (click)="downloadCSV()">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
            <path d="M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4.66666 6.66667L8 10L11.3333 6.66667" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M8 10V2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Download CSV
        </button>
      </div>

      <div class="table-container">
        <table class="sales-log-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Event</th>
              <th>Description</th>
              <th>Quantity</th>
              <th>Buyer/Entity</th>
              <th>Certificate/Link</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let entry of salesLog">
              <td>{{ entry.date }}</td>
              <td>
                <span class="event-badge" [ngClass]="getEventClass(entry.event)">
                  {{ entry.event }}
                </span>
              </td>
              <td>{{ entry.description }}</td>
              <td>{{ entry.quantity | number }}</td>
              <td>{{ entry.buyerEntity }}</td>
              <td>
                <a href="#" class="certificate-link">{{ entry.certificateLink }}</a>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-card">
      <h3 class="sidebar-title">Downloadable & Actions</h3>
      
      <div class="action-buttons">
        <button class="action-btn" (click)="downloadTokenizationReport()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M17.5 12.5V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5.83334 8.33333L10 12.5L14.1667 8.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 12.5V2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Download Tokenization Report (PDF)</span>
        </button>

        <button class="action-btn" (click)="downloadBlockchainProof()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M17.5 12.5V15.8333C17.5 16.2754 17.3244 16.6993 17.0118 17.0118C16.6993 17.3244 16.2754 17.5 15.8333 17.5H4.16667C3.72464 17.5 3.30072 17.3244 2.98816 17.0118C2.67559 16.6993 2.5 16.2754 2.5 15.8333V12.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5.83334 8.33333L10 12.5L14.1667 8.33333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M10 12.5V2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Download Blockchain Proof (JSON)</span>
        </button>

        <button class="action-btn" (click)="viewRetirementCertificates()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M9.16667 2.5H4.16667C3.72464 2.5 3.30072 2.67559 2.98816 2.98816C2.67559 3.30072 2.5 3.72464 2.5 4.16667V15.8333C2.5 16.2754 2.67559 16.6993 2.98816 17.0118C3.30072 17.3244 3.72464 17.5 4.16667 17.5H15.8333C16.2754 17.5 16.6993 17.3244 17.0118 17.0118C17.3244 16.6993 17.5 16.2754 17.5 15.8333V10.8333" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>View All Retirement Certificates</span>
        </button>

        <button class="action-btn" (click)="listMoreTokens()">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <rect x="3" y="3" width="14" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>
            <path d="M10 7V13M7 10H13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>List More Tokens for Sale</span>
        </button>
      </div>
    </div>
  </aside>
</div>